<!DOCTYPE html>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <meta name="robots" content="NOINDEX, NOFOLLOW" />
  <meta name="theme-color" content="#333333">
  <link rel="icon" href="img/favicon.png" type="image/png" />
  <link href="https://fonts.googleapis.com/css?family=Bungee+Shade" rel="stylesheet">
  <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css">
  <link rel="stylesheet" type="text/css" href="css/style.css">
  <title>Bill-splitting, for friends</title>
  <script>
    var ep = 'https://cliffordtky.github.io/projects/lunchbuddies/';
    //ep = 'index.html';
    var ytk = 'AIzaSyA9yf1oSLTnwociXBAroJYlInqj1KfTAPA';
  </script>
</head>
<body>  

<div class="main">

<div class="clear"></div>
<h1 class="apptitle"><a title="Lunch Buddies - Bill splitting for friends" href="https://cliffordtky.github.io/projects/lunchbuddies/">Lunch <span class="logobreaker"></span>Buddies</a></h1>
<div class="container">
  <div class="row">
    <div class="col-xs-12">
      <div class="clear"></div><div class="clear"></div><div class="clear hidden-xs"></div>

      <div class="container editalert">
        <div class="row">
          <div class="col-xs-12">
            <div class="alert alert-info">
              <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
              <p><strong>Editing?</strong> Make changes to the bill and click the "Calculate" button. Or <a style="text-decoration:underline" href="javascript:;" onclick="window.location.reload();">check the bill again</a>. =)</p>
            </div>
          </div>
        </div>
      </div>

      <form class="calc">
        <div class="container-fluid">
          <div class="row">
            <div class="col-xs-1 col-sm-1"></div>
            <div class="col-xs-10 col-sm-6">
              <input type="text" style="background:#dcdca0" placeholder="Where did you go for lunch?" name="w" class="where" required />
            </div>
            <div class="col-xs-1"></div>
            <div class="clear visible-xs"></div>
            <div class="col-xs-1"></div>
            <div class="col-xs-10 col-sm-4">
              <input type="text" style="background:#dcdca0" placeholder="Who paid?" name="b" class="boss" required />
            </div>
            <div class="col-xs-1 col-sm-1"></div>
          </div>            
        </div>
        <div class="clear"></div><div class="clear"></div>
        <div class="container-fluid itemslist">
          <div class="row lineitem" id="1">
            <div class="clear visible-xs" style="border-top:1px solid #cccccc"></div>        
            <div class="col-xs-1 col-sm-1 text-left">
              <span class="nlab">1</span>
            </div>
            <div class="col-xs-10 col-sm-4">
              <input name="f1" type="text" placeholder="eg; Nasi Lemak" class="fooditem" id="fi1" required />
            </div>
            <div class="clear visible-xs"></div>
            <div class="col-xs-1 visible-xs"></div>
            <div class="col-xs-4 col-sm-2">
              <input name="p1" type="number" placeholder="eg; 8.90" class="price" id="p1" step="0.01" required />
            </div>            
            <div class="col-xs-6 col-sm-4">
              <input name="e1" type="text" placeholder="eg; Raseena" class="eater" id="e1" required />
              <a title="Clear this line" href="javascript:;" class="kill" id="k1"><span class="glyphicon glyphicon-remove" aria-hidden="true"></span></a>              
            </div>
            <div class="col-xs-1 col-sm-1 text-center"></div>        
          </div>
          <div class="row lineitem" id="2">
            <div class="clear visible-xs" style="border-top:1px solid #cccccc"></div>       
            <div class="col-xs-1 col-sm-1 text-left">
              <span class="nlab">2</span>
            </div>
            <div class="col-xs-10 col-sm-4">
              <input name="f2" type="text" placeholder="eg; Hor Fun - sauce separate" class="fooditem" id="fi2"/>
            </div>
            <div class="clear visible-xs"></div>
            <div class="col-xs-1 visible-xs"></div>            
            <div class="col-xs-4 col-sm-2">
              <input name="p2" type="number" placeholder="eg; 10.90" class="price" id="p2" step="0.01"/>
            </div>            
            <div class="col-xs-6 col-sm-4">
              <input name="e2" type="text" placeholder="eg cost split; Kelly,Josh" class="eater" id="e2"/>
              <a title="Clear this line" href="javascript:;" class="kill" id="k2"><span class="glyphicon glyphicon-remove" aria-hidden="true"></span></a>
            </div>
            <div class="col-xs-1 col-sm-1 text-center"></div>             
          </div>          
        </div>
        <div class="clear"></div><div class="clear"></div>
        <div class="container-fluid">          
          <div class="row">
            <div class="col-xs-11 text-right">
              <button title="Add 1 more line item" class="addline" type="button"><span class="glyphicon glyphicon-plus" aria-hidden="true"></span> Add a line</button>
            </div>
            <div class="col-xs-1"></div>
          </div>           
          <div class="row">
            <div class="col-xs-12 text-center">
              <div class="clear"></div><div class="clear"></div>
              <div class="container-fluid" style="max-width:320px;margin:auto;">
                <div class="row">
                  <div class="col-xs-2">
                    <input type="checkbox" class="ys" name="ys" value="1"/>
                  </div>
                  <div class="col-xs-10 text-left">
                    <label>Include service chg (10%) ?</label>
                  </div>
                </div>
                <div class="row">
                  <div class="col-xs-2">
                    <input type="checkbox" class="yg" name="yg" value="1"/>
                  </div>
                  <div class="col-xs-10 text-left">
                    <label>Include GST (7%) ?</label>
                  </div>
                </div>
                <div class="row">
                  <div class="col-xs-2">
                    <input type="checkbox" class="x" name="x" value="1"/>
                  </div>
                  <div class="col-xs-10 text-left">
                    <label>Split GST/svc chg evenly ?</label>
                  </div>
                </div>
              </div>
              <div class="clear"></div>
              <button title="Calculate" class="calculate" type="submit"><span class="glyphicon glyphicon-hand-up" aria-hidden="true"></span> Calculate</button>
            </div>
          </div>          
        </div> 
        <input type="hidden" id="sm" name="sm" value="1">
        <input type="hidden" id="tf" name="tf" value="2">
      </form>
      <div class="clear"></div><div class="clear"></div>
    </div>
  </div>
</div>

</div>
<!--//main-->

<div class="bill">
  <div class="bill-header">
    <div class="container">
      <div class="row">
        <div class="col-xs-7">
          <div class="bill-logo hidden-xs"><a title="Bill-splitting for friends" href="https://cliffordtky.github.io/projects/lunchbuddies/">Lunch Buddies</a></div>
          <div class="bill-sm-logo visible-xs"><a title="Bill-splitting for friends" href="https://cliffordtky.github.io/projects/lunchbuddies/"><i class="fa fa-calculator"></i></a></div>
        </div>
        <div class="col-xs-5">
          <div class="bill-redo">
            <a title="Re-start a new bill calculation" onclick="return confirm('Clear the form and re-start another bill calculation?');" href="#" class="btn btn-info pull-right recalc" style="margin-left:6px;">
              <span class="glyphicon glyphicon-repeat"></span><span style="margin-left:5px" class="hidden-xs">Start Over</span>
            </a>
            <a title="Edit bill" href="javascript:;" onclick="edit_bill()" class="btn btn-default pull-right">
              <span class="glyphicon glyphicon-pencil"></span><span style="margin-left:5px" class="hidden-xs">Edit</span>
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="bill-body">
    <div class="clear hidden-xs hidden-sm"></div>
    <div class="container">
      <div class="row">
        <div class="col-xs-12">
            <div class="container-fluid">
              <div class="row">
                <div class="col-sm-12 left">
                  <a class="sharebutt btn btn-primary" href="javascript:;"><i class="fa fa-share-alt"></i> Share this bill</a>
                  <h3>Hey <em>buddies</em>,</h3><br/>
                  <p class="buddies-msg"></p>
                </div>
              </div>
            </div>
            <div class="container-fluid" id="bill_tables">
              <hr>
            </div>
        </div>
      </div>
    </div>
    <hr/>
    <div class="container">
      <div class="row">
        <div class="col-xs-12">
            <div class="clear"></div>
            <h2 class="text-center"><span class="hidden-xs">Paid? Good. </span>Now, watch a video.</h2>
            <div class="clear"></div><div class="clear"></div>
            <div id="videolist"></div>
        </div>
      </div>
    </div>
  </div>
</div>

<div id="sharemod" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <h4 class="modal-title" style="color:#777777">Share the bill..</h4>
      </div>
      <div class="modal-body">
        <p style="color:#777777">Copy and send this link to friends who need to pay for the meal. =)</p>
        <p id="shortlink"></p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-info" data-dismiss="modal"><i class="fa fa-hand-peace-o"></i> OK, got it.</button>
      </div>
    </div>
  </div>
</div>

<div id="sameeatermod" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <h4 class="modal-title" style="color:#777777">Check your items..</h4>
      </div>
      <div class="modal-body">
        <div class="alert alert-danger">
          <strong>Duplicates!</strong> You have entered repeated names on the same line item!
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-info" data-dismiss="modal"><i class="fa fa-hand-peace-o"></i> OK, got it.</button>
      </div>
    </div>
  </div>
</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script>

/* Clifford - Jan 2017 */  

  function getp(name, url) {
    if (!url) {
      url = window.location.href;
    }
    name = name.replace(/[\[\]]/g, "\\$&");
    var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
        results = regex.exec(url);
    if (!results) return null;
    if (!results[2]) return '';
    return decodeURIComponent(results[2].replace(/\+/g, " "));
  }

  function contains(shortstr,longstr){
    if(longstr.indexOf(shortstr) > -1){
      return true;
    }else{
      return false;
    }
  }

  function contains_arr(item,arr){
    for (var w=0; w<arr.length; w++){
      var t = arr[w].toLowerCase();
      item = item.toLowerCase();
      if (t == item){
        return true;
        break;
      }
    }
    return false;
  }

  function addline(){
    var currnum = $('#tf').val();
    var nextnum = parseInt(currnum) + 1;
    var html = '<div class="row lineitem" id="'+nextnum+'">';
    html += '<div class="clear visible-xs" style="border-top:1px solid #cccccc"></div>';
    html += '<div class="col-xs-1 col-sm-1 text-left">';
    html += '<span class="nlab">'+nextnum+'</span>';
    html += '</div>';
    html += '<div class="col-xs-10 col-sm-4">';
    html += '<input name="f'+nextnum+'" type="text" placeholder="eg; Mee hoon soup" class="fooditem" id="fi'+nextnum+'"/>';
    html += '</div>';
    html += '<div class="clear visible-xs"></div>';
    html += '<div class="col-xs-1 visible-xs"></div>';
    html += '<div class="col-xs-4 col-sm-2">';
    html += '<input name="p'+nextnum+'" type="number" placeholder="eg; 3.50" class="price" id="p'+nextnum+'" step="0.01"/>';
    html += '</div>';    
    html += '<div class="col-xs-6 col-sm-4">';
    html += '<input name="e'+nextnum+'" type="text" placeholder="eg; RJ" class="eater" id="e'+nextnum+'"/>';
    html += '<a title="Clear this line" href="javascript:;" class="kill" id="k'+nextnum+'"><span class="glyphicon glyphicon-remove" aria-hidden="true"></span></a>';    
    html += '</div>';
    html += '<div class="col-xs-1 col-sm-1 text-center">';
    html += '</div>';             
    html += '</div>';
    $('.itemslist').append(html);
    $('#tf').val(nextnum);
  }

  function process_form(){
    if (getp('sm') == 1 && getp('boss') != '' && getp('where') != ''){
      var totitems = parseInt(getp('tf'));
      var allnames = '';
      for (var i=1; i<=totitems; i++){
        var rowhtml = '';
        if (i > 2){
          rowhtml += '<div class="row lineitem" id="'+i+'">';
          rowhtml += '<div class="clear visible-xs" style="border-top:1px solid #cccccc"></div>';
          rowhtml += '<div class="col-xs-1 col-sm-1 text-center">';
          rowhtml += '<span class="nlab">'+i+'</span>';
          rowhtml += '</div>';
          rowhtml += '<div class="col-xs-10 col-sm-4">';
          rowhtml += '<input name="f'+i+'" type="text" placeholder="eg; Mee hoon soup" class="fooditem" id="fi'+i+'"/>';
          rowhtml += '</div>';
          rowhtml += '<div class="clear visible-xs"></div>';
          rowhtml += '<div class="col-xs-1 visible-xs"></div>';          
          rowhtml += '<div class="col-xs-4 col-sm-2">';
          rowhtml += '<input name="p'+i+'" type="number" placeholder="eg; 3.50" class="price" id="p'+i+'" step="0.01"/>';
          rowhtml += '</div>';    
          rowhtml += '<div class="col-xs-6 col-sm-4">';
          rowhtml += '<input name="e'+i+'" type="text" placeholder="eg; RJ" class="eater" id="e'+i+'"/>';
          rowhtml += '<a title="Clear this line" href="javascript:;" class="kill" id="k'+i+'"><span class="glyphicon glyphicon-remove" aria-hidden="true"></span></a>';          
          rowhtml += '</div>';
          rowhtml += '<div class="col-xs-1 col-sm-1 text-center">';
          rowhtml += '</div>';             
          rowhtml += '</div>';
          $('.itemslist').append(rowhtml);
        }
        if (getp('f'+i) !='' && getp('e'+i) !='' && getp('p'+i) !=''){
          $('#fi'+i).val(getp('f'+i));
          $('#e'+i).val(getp('e'+i));
          $('#p'+i).val(getp('p'+i));
          $('#k'+i).css('visibility','visible');
                  
          allnames += getp('e'+i) + ',';
        }
      }

      /* Bill calculation magic happens here */

      /* Form unique name list */
      allnames = format_eaters(allnames);
      allnames = allnames.substring(0, allnames.length-1).toLowerCase();
      //console.log(allnames);
      var namesarray = allnames.split(',');
      var eaters = [];
      for (var j=0; j<namesarray.length; j++){
        var singlename = namesarray[j];
        if ($.inArray(singlename, eaters) ==  -1){
          eaters.push(singlename);
        }
      }
      eaters.sort();

      /* Assign items to individual names */
      var items_eaten = [];
      for (var k=0; k<eaters.length; k++){
        var inditems = [];
        for (var l=1; l<=totitems; l++){
          var itemcollection = [];
          var thenames = getp('e'+l).toLowerCase();
          thenames = format_eaters(thenames);
          var theitem = getp('f'+l);
          var ntype = 'individual';
          var pricing = money_it(getp('p'+l));
          var split_with = 'nobody';
          if (contains(',',thenames)){
            ntype = 'split';
            var numnames = thenames.split(',').length;
            var split_pricing = pricing / numnames;
            split_pricing = money_it(split_pricing);
            split_with = drop_item(thenames.split(','),eaters[k]);
            itemcollection.push(theitem,split_pricing,ntype,split_with);
          }else{
            itemcollection.push(theitem,pricing,ntype,split_with);
          }
          if (contains_arr(eaters[k],thenames.split(','))){
            inditems.push(itemcollection);
          }
        }
        items_eaten.push(inditems);
      }

      /* Calculate grand totals */
      
      var grand_total_items = 0;
      var grand_total_svc_chg = 0;
      var grand_total_gst = 0;

      for (var c=1; c<=totitems; c++){
        if (getp('p'+c) != ''){
          var grand_summer = parseFloat(getp('p'+c));
          grand_total_items += parseFloat(grand_summer);  
        }
      }
      grand_total_items = parseFloat(grand_total_items);
      if (getp('ys') == 1){
        grand_total_svc_chg = parseFloat(grand_total_items*0.1);
      }else{
        grand_total_svc_chg = parseFloat(grand_total_svc_chg);
      }
      if (getp('yg') == 1){
        grand_total_gst = parseFloat((grand_total_items+grand_total_svc_chg)*0.07);     
      }else{
        grand_total_gst = parseFloat(grand_total_gst);
      }

      /* Calculate total spending per person */
      var spending_totals = [];
      for (var m=0; m<items_eaten.length; m++){
        var numitems = items_eaten[m].length;
        var totholder = [];
        var adder = 0;
        if (numitems > 1){
          for (var n=0; n<numitems; n++){
            adder = parseFloat(adder) + parseFloat(items_eaten[m][n][1]);
          }
        }else{
          adder = parseFloat(items_eaten[m][0][1]);
        }
        adder = money_it(adder);

        var totsvc = money_it(0);
        var svc = money_it(0);
        var totgst = money_it(0);
        var gst = money_it(0);

        if (getp('x') == 1){
          // split gst & svc evenly
          var pplcount = eaters.length;
          if (getp('ys') == 1){
            svc = parseFloat(grand_total_svc_chg / pplcount);
            totsvc = adder+svc;
            svc = money_it(svc);
          }
          if (getp('yg') == 1){
            if (totsvc != ''){          
              gst = parseFloat(grand_total_gst / pplcount);
              totgst = parseFloat(adder) + parseFloat(svc) + parseFloat(gst);
              gst = money_it(gst);
              totgst = money_it(totgst);              
            }else{
              totgst = parseFloat(adder) + parseFloat(gst);
              totgst = money_it(totgst);              
            }
          }

        }else{
          // everyone pays his/her own gst & svc chg
          if (getp('ys') == 1){
            totsvc = money_it(adder*1.1);
            svc = money_it(adder*0.1);
          }else{
            totsvc = money_it(adder);
          }
          if (getp('yg') == 1){
            if (totsvc != ''){
              totgst = money_it(totsvc*1.07);  
              gst = money_it(totsvc*0.07);
            }else{
              totgst = money_it(adder*1.07);  
              gst = money_it(adder*0.07);
            }
          }else{
            totgst = totsvc;
          }     
        }
        totholder.push([adder,svc,gst,totgst]);
        spending_totals.push(totholder);
      }
      
      /* Filling up other mandatory info */
      $('.where').val(getp('w'));
      $('.boss').val(getp('b'));
      $('#tf').val(getp('tf'));
      $('#sm').val(getp('sm'));
    }
    if (getp('yg') == '1'){
      $('.yg').attr('checked', true);
    }
    if (getp('ys') == '1'){
      $('.ys').attr('checked', true);
    }
    if (getp('x') == '1'){
      $('.x').attr('checked', true);
    }

    /* Totals, items and people check */
    //console.log(eaters+' - '+eaters.length);
    //console.log(items_eaten);
    //console.log(spending_totals);
    //console.log(grand_total_items);
    //console.log(grand_total_svc_chg);
    //console.log(grand_total_gst);

    /* Draw Bill */
    var buddies_msg = 'Please pay <b>'+getp('b')+'</b> for the meal @ <b>'+getp('w')+'</b>!';
    $('.buddies-msg').html(buddies_msg);

    var meal_chg_msg = '';
    meal_chg_msg += '<div class="clear"></div><p>* Note : This meal:<ul>';
    if (getp('ys') == '1'){
      meal_chg_msg += '<li>Includes service charge.</li>';    
    }else{
      meal_chg_msg += '<li>Does not include service charge.</li>';
    }      
    if (getp('yg') == '1'){
      meal_chg_msg += '<li>Includes GST.</li>';
    }else{
      meal_chg_msg += '<li>Does not include GST.</li>';
    }      
    if (getp('x') == '1'){ 
      if (getp('ys') == '1' && getp('yg') == '1'){
        meal_chg_msg += '<li>Service charge & GST are split among <u>'+eaters.length+' people</u> evenly.</li>';
      }else if (getp('ys') == '1' && getp('yg') != '1'){
        meal_chg_msg += '<li>Service charge is split among <u>'+eaters.length+' people</u> evenly.</li>';
      }else if (getp('ys') != '1' && getp('yg') == '1'){
        meal_chg_msg += '<li>GST is split among <u>'+eaters.length+' people</u> evenly.</li>';
      }
    }
    meal_chg_msg += '</ul></p>';
    $('.left').append(meal_chg_msg);

    /* Draw the split bill tables */
    
    for (var u=0; u<eaters.length; u++){
      var split_tables = '';
      split_tables += '<div class="row">';
      split_tables += '<div class="col-sm-12 col-md-3">';
      split_tables += '<h3 class="eater">'+eaters[u].toUpperCase()+'</h3>';
      split_tables += '</div>';
      split_tables += '<div class="col-sm-12 col-md-9">';
      split_tables += '<table class="table table-condensed">';
      split_tables += '<thead>';
      split_tables += '<tr class="active">';
      split_tables += '<th class="col-xs-1">#</th>';
      split_tables += '<th class="col-xs-9">Food / Beverage</th>';
      split_tables += '<th class="col-xs-2">Price (S$)</th>';      
      split_tables += '</tr>';
      split_tables += '</thead>';
      split_tables += '<tbody>';
      // loop items
      for (var v=0; v<items_eaten[u].length; v++){
        split_tables += '<tr>';
        split_tables += '<td>'+(v+1)+'</td>';
        split_tables += '<td>';
        split_tables += items_eaten[u][v][0];
        if (items_eaten[u][v][2] == 'split'){
          split_tables += '<br/>';
          var sharing_eaters = items_eaten[u][v][3];
          var se_count = sharing_eaters.length + 1;
          split_tables += '<span class="small">(Cost split '+se_count+'-ways with '+sharing_eaters.join().toUpperCase()+")</span>";
        }
        split_tables += '</td>';
        split_tables += '<td>$';
        split_tables += items_eaten[u][v][1];
        split_tables += '</td>';
        split_tables += '</tr>';        
        if (v == (items_eaten[u].length-1)){
          // last item for the eater; put in totals
          split_tables += '<tr>';
          split_tables += '<td></td>';
          split_tables += '<td class="text-right">Sub-total : </td>';
          split_tables += '<td>$';
          split_tables += spending_totals[u][0][0];        
          split_tables += '</td>';
          split_tables += '</tr>';        
          if (getp('ys') == '1'){
            split_tables += '<tr>';
            split_tables += '<td></td>';
            split_tables += '<td class="text-right">Service Chg';
            if (getp('x') == '1'){
              split_tables += ' (10% '+eaters.length+'-way split)';
            }else{
              split_tables += ' (10%)';  
            }
            split_tables += ' : </td>';
            split_tables += '<td>$';
            split_tables += spending_totals[u][0][1];        
            split_tables += '</td>';
            split_tables += '</tr>';    
          }  
          if (getp('yg') == '1'){
            split_tables += '<tr>';
            split_tables += '<td></td>';
            split_tables += '<td class="text-right">GST';
            if (getp('x') == '1'){
              split_tables += ' (7% '+eaters.length+'-way split)';
            }else{
              split_tables += ' (7%)';  
            }
            split_tables += ' : </td>';
            split_tables += '<td>$';
            split_tables += spending_totals[u][0][2];        
            split_tables += '</td>';
            split_tables += '</tr>';    
          } 
          split_tables += '<tr style="color:#0aa3dc">';
          split_tables += '<td></td>';
          split_tables += '<td class="text-right">Total Payable : </td>';
          split_tables += '<td>$';
          split_tables += spending_totals[u][0][3];        
          split_tables += '</td>';
          split_tables += '</tr>';
        }
      }      
      split_tables += '</tbody>';
      split_tables += '</table>';                
      split_tables += '</div>';
      split_tables += '</div>';
      split_tables += '<hr><div class="clear"></div>';
      $('#bill_tables').append(split_tables); 
    }

    var gtotals = '';    
    gtotals += '<div class="row">';
    gtotals += '<div class="col-sm-12 col-md-3">';
    gtotals += '</div>';
    gtotals += '<div class="col-sm-12 col-md-9">';
    gtotals += '<table class="table table-condensed">';
    gtotals += '<thead>';
    gtotals += '<tr class="active">';
    gtotals += '<th class="col-xs-1"></th>';
    gtotals += '<th class="col-xs-9">Total For Everyone</th>';
    gtotals += '<th class="col-xs-2"></th>';      
    gtotals += '</tr>';
    gtotals += '</thead>';    
    gtotals += '<tbody>';
    gtotals += '<tr style="color:#0aa3dc;font-weight:bold;">';
    gtotals += '<td></td>';
    gtotals += '<td class="text-right">Total Items Cost : </td>';
    gtotals += '<td>$';
    gtotals += money_it(grand_total_items);        
    gtotals += '</td>';
    gtotals += '</tr>';        
    gtotals += '<tr style="color:#0aa3dc;font-weight:bold;">';
    gtotals += '<td></td>';
    gtotals += '<td class="text-right">Total Service Chg : </td>';
    gtotals += '<td>$';
    gtotals += money_it(grand_total_svc_chg);        
    gtotals += '</td>';
    gtotals += '</tr>';  
    gtotals += '<tr style="color:#0aa3dc;font-weight:bold;">';
    gtotals += '<td></td>';
    gtotals += '<td class="text-right">Total GST : </td>';
    gtotals += '<td>$';
    gtotals += money_it(grand_total_gst);        
    gtotals += '</td>';
    gtotals += '</tr>'; 
    gtotals += '<tr style="color:#0aa3dc;font-weight:bold;">';
    gtotals += '<td></td>';
    gtotals += '<td class="text-right"><b>Grand Total</b> : </td>';
    gtotals += '<td>$';
    gtotals += money_it(parseFloat(grand_total_items)+parseFloat(grand_total_svc_chg)+parseFloat(grand_total_gst));        
    gtotals += '</td>';
    gtotals += '</tr>';      
    gtotals += '</tr>'; 
    gtotals += '<tr style="color:#0aa3dc;text-align:right">';
    gtotals += '<td colspan="2"></td>';
    gtotals += '<td></td>';
    gtotals += '</tr>';          
    gtotals += '</tbody>';
    gtotals += '</table>';                
    gtotals += '</div>';
    gtotals += '</div>';
    $('#bill_tables').append(gtotals); 

    $('title').text('Bill split - Lunch @ '+getp('w').toUpperCase());
    show_bill();
  }

  function show_main(){
    $('.main').show();
    $('body').addClass('y-scroll');
  }

  function hide_main(){
    $('.main').hide();
    $('body').removeClass('y-scroll');
  }

  function show_bill(){
    create_short_uri();
    $('.bill').show();
    reward_eaters();
    hide_main();
  }
  function hide_bill(){
    //$('.editalert').show().delay(5000).fadeOut();
    $('.editalert').show();
    show_main();
    window.scrollTo(0,0);
    $('.bill').hide();
  }

  function edit_bill(){
    hide_bill();
  }

  function create_short_uri(){
    uri = window.location.href;
    $.getScript("https://is.gd/create.php?format=json&callback=short_uri&url="+encodeURIComponent(uri)).done(function(){});
  }

  function short_uri(uri_data){
    $('#shortlink').append('<div class="alert alert-info"><p><a target="_blank" href="'+uri_data.shorturl+'">'+uri_data.shorturl+'</a></p></div>');    
  }

  function drop_item(arr_data,itemtodrop){
    var index = arr_data.indexOf(itemtodrop);
    if (index > -1) {
      arr_data.splice(index, 1);
    }
    return arr_data;
  }

  function arr_has(arr,obj) {
    return (arr.indexOf(obj) != -1);
  }

  function no_dup(str, separator) {
      var arr = str && str.split(separator || ","),
          l = arr && arr.length,
          o = {}; 

      for (var i = 0; i < l; i++) {
          if (o.hasOwnProperty( arr[i] )) {
              return false;
          } else {
              o[ arr[i] ] = true;
          }
      }
      return true;
  }

  function money_it(fl){
    return parseFloat(Math.round(fl * 100) / 100).toFixed(2);
  }

  function format_eaters(str){
    for (var x=0; x<=10; x++){
      str = str.replace(", ",",").replace(" ,",",");  
    }
    return str;
  }

  function strip_spaces(str){ 
   return str.replace(/ /g,"");      
  }

  function reward_eaters(){
    $.getScript("https://www.googleapis.com/youtube/v3/videos?part=snippet&chart=mostPopular&regionCode=SG&maxResults=11&key="+ytk+"&callback=show_videos").done(function(){});
  }

  function show_videos(videos){
    var videolist = videos.items;
    var videohtml = '';
    var rn = parseInt(Math.random() * (10 - 0) + 0);
    for (var v=0; v<videolist.length; v++){
      var video_id = videolist[v].id;
      var video_channel = videolist[v].snippet.channelTitle;
      var video_channelId = videolist[v].snippet.channelId;
      var video_title = videolist[v].snippet.title;
      var video_desc = videolist[v].snippet.description;
      var video_pubd = videolist[v].snippet.publishedAt;
      var video_thumb = videolist[v].snippet.thumbnails.medium.url;
      //console.log('v='+v);
      //console.log('rn='+rn);      
      if (v == rn){
        videohtml += '<div class="vid-container">';
        videohtml += '<iframe id="vid_frame" src="https://www.youtube.com/embed/'+video_id+'?rel=0&showinfo=0&autohide=1" width="560" height="315" frameborder="0"></iframe>';
        videohtml += '</div>';
        videohtml += '<div class="container-fluid">';
        videohtml += '<div class="row">';
        videohtml += '<div class="col-xs-12">';
        videohtml += '<h3>'+video_title+'</h3>';
        videohtml += '<span style="color:#888888">Via <a target="_blank" href="https://www.youtube.com/channel/'+video_channelId+'">'+video_channel+'</a> on '+video_pubd.split('T')[0]+'</span>';
        videohtml += '<div class="clear"></div>';
        //videohtml += '<p class="small" style="font-size:15px">'+video_desc+'</p>';
        videohtml += '</div>';
        videohtml += '</div>';
        videohtml += '</div>';
        break;
      }    
    }
    $('#videolist').append(videohtml);
  }

  $('.addline').click(function(){
    addline();
  });

  $('.sharebutt').click(function(){
    $('#sharemod').modal('show');
  });

  $('.itemslist').on('click', '.kill' ,function(){
    var idn = $(this).attr('id').replace('k','');
    $('#e'+idn).val('');
    $('#p'+idn).val('');
    $('#fi'+idn).val('').focus();
    $(this).css('visibility','hidden');
  });    
    
  $('.itemslist').on('keyup', '.fooditem,.eater,.price' ,function(){
    for (var a=1; a<=$('#tf').val(); a++){
      if ($('#fi'+a).val() != '' || $('#e'+a).val() != '' || $('#p'+a).val() != ''){
        $('#k'+a).css('visibility','visible');
      }else{
        $('#k'+a).css('visibility','hidden');
      }         
    }
  });  

  $('.eater').on('keyup',function(){
    var has_repeated = false;
    if ($(this).val() != ''){
      var eaterlist = $(this).val().toLowerCase();
      if (!no_dup(eaterlist,',')){
        has_repeated = true;
      }
    }
    if (has_repeated){
      $('#sameeatermod').modal('show');
      console.log('Same eater!');
    }
  });

  $(document).ready(function(){
    $('.calc').attr('action',ep);
    $('.recalc').attr('href',ep);
    $('.bill-logo a,.bill-sm-logo a').attr('href',ep);
    if (getp('sm') == 1){
      process_form();
    }
  });

</script>
</body>
</html>